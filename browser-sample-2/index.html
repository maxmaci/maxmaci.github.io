<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
	body {
  /* margin: 0; */
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu',
    'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: rgb(250, 217, 246);
}

label {
  margin: 0.5em;
}

.section {
  margin: 1em;
}
	</style>
</head>

<body>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<button onclick="doInitialize()">initialize with URL and KEY</button>
<p>
  <input id="SUPABASE_URL" value="https://rusnokzoqnrxuoesoxpp.supabase.co">
  <input id="SUPABASE_KEY" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1c25va3pvcW5yeHVvZXNveHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTM2NjAwMDksImV4cCI6MjAwOTIzNjAwOX0.XEqMyuJ3Rj4Ko4lcAAbm8uBhqovhWEUuAQe2HRqEnHE">
<script>
  let $ = document.querySelector.bind(document);

// document.addEventListener('DOMContentLoaded', function (event) {
console.log("ready");
let SUPABASE_URL = "";
let SUPABASE_KEY = "";

let supa;

let myEmail = "a@b.com";
let myPassword = "abc123";

let doInitialize = async () => {
  // Initialize
  SUPABASE_URL = $("#SUPABASE_URL").value;
  SUPABASE_KEY = $("#SUPABASE_KEY").value;

  supa = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  log("Initialized SupaBase");
};

let doSignUp = async () => {
  const { user, session, error } = supa.auth.signUp({
    email: myEmail,
    password: myPassword
  });
  log({ user, session, error });
};

let doSignIn = async () => {
  const { user, session, error } = await supa.auth.signIn({
    email: myEmail,
    password: myPassword
  });
  log({ user, session, error });
};

let doSignOut = async () => {
  const { error } = await supa.auth.signOut();
  log(error);
};

let doRead = async () => {
  supa
    .from("test")
    .select()
    // .eq('public', true)
    .then((response) => {
      // Do something with the response
      log(response.data[0]);
    });
};

function log(t) {
  document.getElementById("log").innerText = JSON.stringify(t, 2, 2);
}
</script>
</p>

<p>
  <button onclick="doSignUp()">sign up (once)</button>
</p>
<p>
  <button onclick="doSignIn()">sign in</button>
  <button onclick="doSignOut()">sign out</button>
  <button onclick="doRead()">read table entry</button>

</p>
<p>
  <code id="log">log</code>
</p>
<hl>
  <h4>Instructions</h4>

  <p>1. Get an account on <a href="https://app.supabase.io/">SupaBase</a> and create a project. Copy key and url.
  </p>
  <p>2. Create a table called 'test' with one entry, and activate RLS with this rule:</p>
  <code>CREATE POLICY "t1" ON public.test FOR SELECT USING (auth.role() = 'authenticated');</code>
  <p>3. On the Auth/Settings page, disable Email confirmation.</p>
  <p>Now you should be able to sign up (once) and you should see the table entry only if you are logged in.</p>
</html>